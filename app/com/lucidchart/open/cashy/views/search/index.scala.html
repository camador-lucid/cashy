@import com.lucidchart.open.cashy.controllers.SearchParams
@import com.lucidchart.open.cashy.models.{Asset, User}
@import com.lucidchart.open.cashy.controllers.{routes=>cashyRoutes}
@import com.lucidchart.open.cashy.views.html.helpers.assetDetails
@import com.lucidchart.open.cashy.views
@(
  searchForm: Form[SearchParams],
  results: List[Asset],
  query: Option[String]
)(
  implicit request: play.api.mvc.Request[_],
  user: User,
  buckets: Set[String]
)

@views.html.layouts.main(
  title="Search Results",
  userOption=Some(user),
  searchForm=searchForm
) {
  <h2>Search Results</h2>
  <hr>
  @if(results.isEmpty) {
    <p>No results.</p>
  } else {
    @for(result <- results) {
      <p>
        <a href="@cashyRoutes.BrowseController.index(result.bucket, result.parent)" target="_blank"><span class="glyphicon glyphicon-folder-open"></span></a>

        @if(query.isDefined && !query.get.contains("%")) {
          <a href="@result.link" class="asset asset-@result.bucket" data-key="@result.key">
            <span>@result.bucket/@result.key.substring(0,result.key.toLowerCase.lastIndexOf(query.get.toLowerCase))</span
            ><span class="highlight">@result.key.substring(result.key.toLowerCase.lastIndexOf(query.get.toLowerCase)).take(query.get.length)</span
            ><span>@result.key.substring(result.key.toLowerCase.lastIndexOf(query.get.toLowerCase)+query.get.length)</span>
          </a>
        } else {
          <a href="#" class="asset-@result.bucket" data-key="@result.key">@result.bucket/@result.key</a>
        }
      </p>
    }
  }

  @for(bucket <- buckets) {
    @{ assetDetails(bucket, "asset-" + bucket) }
  }

  <style>
    .glyphicon-folder-open { margin-left: 10px; margin-right: 10px; }
    a.asset {
      font-size: 16px;
    }
    a.asset .highlight {
      background-color: rgba(52,151,183,.25);
      font-weight: bolder;
    }
  </style>
}
